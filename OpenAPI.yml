openapi: '3.0.3'
info:
  title: 'Notifications Server'
  version: '1.0'
servers:
  - url: 185.92.192.88:3000/api
    description: Production server
  - url: 185.92.192.88:3001/dev/api
    description: Development server
paths:
  /zones:
    post:
      summary: Add a new zone.
      description: Inserts a new zone record into the database.
      tags:
        - Zone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZoneRequestBody'           
      responses:
        '200':
          description: Zone added successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/DuplicateEntryError'
                  - $ref : '#/components/schemas/InvalidInputError'
        '500':
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    get:
      summary: Get all zones.
      description: Retrieves a list of all zones.
      tags:
        - Zone
      responses:
        '200':
          description: List of zones retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  devices:
                    $ref: '#/components/schemas/Zones'
        '500':
          description: Error while retrieving zones.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /zones/{id}:
    get:
      summary: Get zone by ID.
      description: Retrieves details of a specific zone by ID.
      tags:
        - Zone
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the zone to retrieve.
      responses:
        '200':
          description: Zone retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  device:
                    oneOf:
                      - $ref: '#/components/schemas/Zone'
                      - type: string
                        example: No zone found.
        '500':
          description: Error while retrieving the zone.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    put:
      summary: Update a zone.
      description: Updates a zone's details by ID.
      tags:
        - Zone
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the zone to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZoneRequestBody'
      responses:
        '200':
          description: Zone updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '404':
          description: Zone not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Zone not found.
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                oneOf:
                 - $ref: '#/components/schemas/DuplicateEntryError'
                 - $ref: '#/components/schemas/InvalidInputError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    delete:
      summary: Delete a zone.
      description: Deletes a zone by its ID.
      tags:
        - Zone
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the zone to delete.
      responses:
        '200':
          description: Zone deleted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Zone deleted successfully.
        '404':
          description: Zone not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Zone not found.
        '400':
          description: Invalid ID format.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvalidInputError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /partitions:
    post:
      summary: Add a new partition.
      description: Inserts a new partition record into the database.
      tags:
        - Partition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartitionRequestBody'           
      responses:
        '200':
          description: Partition added successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/DuplicateEntryError'
                  - $ref : '#/components/schemas/InvalidInputError'
        '500':
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    get:
      summary: Get all partitions.
      description: Retrieves a list of all partitions.
      tags:
        - Partition
      responses:
        '200':
          description: List of partitions retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  devices:
                    $ref: '#/components/schemas/Partitions'
        '500':
          description: Error while retrieving partitions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /partitions/{id}:
    get:
      summary: Get partition by ID.
      description: Retrieves details of a specific partition by ID.
      tags:
        - Partition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the partition to retrieve.
      responses:
        '200':
          description: Partition retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  device:
                    oneOf:
                      - $ref: '#/components/schemas/Partition'
                      - type: string
                        example: No partition found.
        '500':
          description: Error while retrieving the partition.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    put:
      summary: Update a partition.
      description: Updates a partition's details by ID.
      tags:
        - Partition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the partition to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartitionRequestBody'
      responses:
        '200':
          description: Partition updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '404':
          description: Partition not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Partition not found.
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                oneOf:
                 - $ref: '#/components/schemas/DuplicateEntryError'
                 - $ref: '#/components/schemas/InvalidInputError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    delete:
      summary: Delete a partition.
      description: Deletes a partition by its ID.
      tags:
        - Partition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the partition to delete.
      responses:
        '200':
          description: Partition deleted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Zone deleted successfully.
        '404':
          description: Zone not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Zone not found.
        '400':
          description: Invalid ID format.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvalidInputError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'


  /devices:
    post:
      summary: Add a new device.
      description: Inserts a new device record into the database.
      tags:
        - Device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceRequestBody'           
      responses:
        '200':
          description: Device added successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '400':
          description: Duplicate device data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateEntryError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    get:
      summary: Get all devices.
      description: Retrieves a list of all devices.
      tags:
        - Device
      responses:
        '200':
          description: List of devices retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  devices:
                    $ref: '#/components/schemas/Devices'
        '500':
          description: Error while retrieving devices.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /devices/{id}:
    get:
      summary: Get device by ID.
      description: Retrieves details of a specific device by ID.
      tags:
        - Device
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the device to retrieve.
      responses:
        '200':
          description: Device retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  device:
                    oneOf:
                      - $ref: '#/components/schemas/Device'
                      - type: string
                        example: No device found.
        '500':
          description: Error while retrieving the device.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    put:
      summary: Update a device.
      description: Updates a device's details by ID.
      tags:
        - Device
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the device to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceRequestBody'
      responses:
        '200':
          description: Device updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 1
        '404':
          description: Device not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Device not found.
        '400':
          description: Duplicate device data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateEntryError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

    delete:
      summary: Delete a device.
      description: Deletes a device by its ID.
      tags:
        - Device
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the device to delete.
      responses:
        '200':
          description: Device deleted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Device deleted successfully.
        '404':
          description: Device not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Device not found.
        '400':
          description: Invalid ID format.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvalidInputError'
        '500':
          description: Unknown error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /notifications/send:
    post:
      summary: Send a notification.
      description: Sends a notification to a mobile device.
      tags:
        - Notification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - identifier
              properties:
                identifier:
                  type: string
                  description: |
                    A unique identifier consisting of exactly 8 hexadecimal characters.
                    Valid characters include numbers (0-9) and letters (A-F, a-f).
                  example: "3A0DE20B"
                  pattern: "^[A-Fa-f0-9]{8}$"
                cid:
                  type: string
                  description: |
                    CID message format consisting of exactly 20 numeric characters.
                  example: "00050001101412004198"
                  pattern: "^[0-9]{20}$"

      responses:
        '200':
          description: Notification send success,
          content: 
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Successfully sent message.
        '400':
          description: Invalid FCM registration token.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Invalid FCM registration token provided. Please check the token.
        '500':
          description: Unexpected error while sending the notification.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

components:
  schemas:
    DuplicateEntryError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Duplicate entry found"
    DeviceRequestBody:
      type: object
      required:
      - identifier
      properties:
        identifier:
          type: string
          description: |
            A unique identifier consisting of exactly 8 hexadecimal characters.
            Valid characters include numbers (0-9) and letters (A-F, a-f).
          example: "3A0DE20B"
          pattern: "^[A-Fa-f0-9]{8}$"
    ZoneRequestBody:
      type: object
      required:
      - name
      - number
      properties:
        name:
          type: string
          example: "Zone 1"
        number:
          type: integer
          example: 
    PartitionRequestBody:
      type: object
      required:
      - name
      - number
      properties:
        name:
          type: string
          example: "Partition 1"
        number:
          type: integer
          example: 10
        
    Device:
      type: object
      required:
      - id
      - identifier
      - account_id
      properties:
        id:
          type: integer
          example: 1
        identifier:
          type: string
          description: |
            A unique identifier consisting of exactly 8 hexadecimal characters.
            Valid characters include numbers (0-9) and letters (A-F, a-f).
          example: "3A0DE20B"
          pattern: "^[A-Fa-f0-9]{8}$"
        account_id:
          type: integer
          description: |
            References the `id` of an `Account` object.
          example: 1
    Devices:
      type: array
      items:
        $ref: '#/components/schemas/Device'
    Zone:
      type: object
      required:
      - id
      - name
      - number
      - account_id
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Zone 1"
        number:
          type: integer
          example: 100
        account_id:
          type: integer
          description: |
            References the `id` of an `Account` object.
          example: 1
    Zones:
      type: array
      items:
        $ref: '#/components/schemas/Zone'
    Partition:
      type: object
      required:
      - id
      - name
      - number
      - account_id
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Partition 1"
        number:
          type: integer
          example: 10
        account_id:
          type: integer
          description: |
            References the `id` of an `Account` object.
          example: 1
    Partitions:
      type: array
      items:
        $ref: '#/components/schemas/Partition'
    InternalServerError:
      type: object
      required:
        - success
        - message
        - error
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: An unexpected error occurred while sending the notification.
        error:
          type: string
          example: "Error details."
    InvalidInputError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Invalid input format"

